# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¬ãƒ“ãƒ¥ãƒ¼

## ç·è©•

ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã¯è‰¯å¥½ã§ã™ãŒã€Server/Client ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½¿ã„åˆ†ã‘ã«æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒæˆ¦ç•¥ã¨ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æœ€é©åŒ–ã«æ³¨åŠ›ã™ã‚‹ã“ã¨ã§ã€æ›´ãªã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸ŠãŒæœŸå¾…ã§ãã¾ã™ã€‚

## ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºåˆ†æ

### ğŸ‘ ç¾çŠ¶ï¼ˆè‰¯å¥½ï¼‰
```
Route (app)                               Size     First Load JS
â”Œ â—‹ /                                     1.37 kB         82.9 kB
â”œ â—‹ /_not-found                           885 B           82.4 kB
â”œ Æ’ /admin2                               4.83 kB         86.3 kB
â”œ Æ’ /edit2                                1.37 kB         82.9 kB
â”œ Æ’ /mypage2                              4.83 kB         86.3 kB
â”œ â—‹ /privacy-policy                       1.37 kB         82.9 kB
â”œ Æ’ /signin2                              4.83 kB         86.3 kB
â”” Æ’ /signup2                              4.83 kB         86.3 kB

â—‹  (Static)   automatically rendered as static HTML
Æ’  (Dynamic)  server-rendered on demand
```

**å¼·ã¿**:
- First Load JS ãŒ 101 kB ã¨è»½é‡
- é™çš„ãƒšãƒ¼ã‚¸ã®é©åˆ‡ãªæœ€é©åŒ–
- å‹•çš„ãƒšãƒ¼ã‚¸ã‚‚ 86.3 kB ã«æŠ‘åˆ¶

### âš ï¸ æœ€é©åŒ–æ©Ÿä¼š

#### 1. ã‚³ãƒ¼ãƒ‰åˆ†å‰²ã®å°å…¥
```typescript
// ç¾çŠ¶: å…¨ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒåŒæœŸçš„ã«ãƒ­ãƒ¼ãƒ‰
import AdminPanel from '@/components/admin2/Admin';

// æ¨å¥¨: å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
const AdminPanel = dynamic(() => import('@/components/admin2/Admin'), {
  loading: () => <AdminSkeleton />,
  ssr: false,
});

const UserManagement = dynamic(() => import('@/components/admin2/UserManagement'), {
  loading: () => <TableSkeleton />,
});
```

#### 2. æœªä½¿ç”¨ã‚³ãƒ¼ãƒ‰ã®é™¤å»
```bash
# ãƒãƒ³ãƒ‰ãƒ«è§£æã®å®Ÿè¡Œ
npm install --save-dev @next/bundle-analyzer

# æœªä½¿ç”¨ã®ä¾å­˜é–¢ä¿‚ã®ç‰¹å®š
npx depcheck
```

## Server/Client ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæœ€é©åŒ–

### ğŸ‘ è‰¯ã„å®Ÿè£…
```typescript
// src/app/components/mypage2/MyPage.tsx
'use server';

export default async function MyPage() {
  const cookieStore = await cookies();
  const userId = cookieStore.get('user_id')?.value || 'æœªãƒ­ã‚°ã‚¤ãƒ³';
  
  // ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ãƒ‡ãƒ¼ã‚¿å–å¾—
  return (
    <div>
      <h1>ãƒã‚¤ãƒšãƒ¼ã‚¸</h1>
      <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: {userId}</p>
    </div>
  );
}
```

### âš ï¸ æ”¹å–„ãŒå¿…è¦ãªç®‡æ‰€

#### 1. ä¸å¿…è¦ãª Client Component
```typescript
// å•é¡Œ: ãƒ•ã‚©ãƒ¼ãƒ ã§ãªã„å ´åˆã¯ Server Component ã§ååˆ†
'use client';

// å¤šãã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ä¸å¿…è¦ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹
```

#### 2. ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–éƒ¨åˆ†ã®åˆ†é›¢
```typescript
// ç¾çŠ¶: å…¨ä½“ãŒ Client Component
'use client';
export default function AdminPage() {
  return (
    <div>
      <Header /> {/* é™çš„ */}
      <DataTable /> {/* ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ– */}
      <Footer /> {/* é™çš„ */}
    </div>
  );
}

// æ¨å¥¨: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–éƒ¨åˆ†ã®ã¿ Client Component
export default function AdminPage() {
  return (
    <div>
      <Header />
      <ClientDataTable />
      <Footer />
    </div>
  );
}

// components/ClientDataTable.tsx
'use client';
export default function ClientDataTable() {
  // ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªæ©Ÿèƒ½ã®ã¿
}
```

## ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒæœ€é©åŒ–

### ç¾çŠ¶ã®å•é¡Œ

#### 1. Supabase ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®é‡è¤‡ä½œæˆ
```typescript
// å•é¡Œ: å„é–¢æ•°ã§æ–°ã—ã„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆ
export async function signIn(email: string, password: string) {
  const supabase = createClient(); // æ¯å›æ–°è¦ä½œæˆ
  // ...
}
```

#### 2. é †æ¬¡ãƒ‡ãƒ¼ã‚¿å–å¾—
```typescript
// å•é¡Œ: é †æ¬¡å®Ÿè¡Œã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ãŒé•·ã„
const user = await getUser();
const todos = await getTodos();
const settings = await getSettings();
```

### æ”¹å–„ææ¡ˆ

#### 1. ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å°å…¥
```typescript
// src/lib/supabase-singleton.ts
class SupabaseClient {
  private static instance: SupabaseClient;
  private client: SupabaseClientType;

  private constructor() {
    this.client = createClient(
      process.env.NEXT_PUBLIC_SUPABASE_URL!,
      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
    );
  }

  public static getInstance(): SupabaseClientType {
    if (!SupabaseClient.instance) {
      SupabaseClient.instance = new SupabaseClient();
    }
    return SupabaseClient.instance.client;
  }
}

export const supabase = SupabaseClient.getInstance();
```

#### 2. ä¸¦åˆ—ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒ
```typescript
// src/lib/data-fetching.ts
export async function getPageData(userId: string) {
  const [user, todos, settings] = await Promise.all([
    getUser(userId),
    getTodos(userId),
    getUserSettings(userId),
  ]);

  return { user, todos, settings };
}

// ä½¿ç”¨ä¾‹
export default async function DashboardPage() {
  const data = await getPageData(userId);
  return <Dashboard {...data} />;
}
```

#### 3. React Suspense ã®æ´»ç”¨
```typescript
// src/components/Dashboard.tsx
export default function Dashboard() {
  return (
    <div>
      <Suspense fallback={<UserSkeleton />}>
        <UserProfile />
      </Suspense>
      
      <Suspense fallback={<TodoSkeleton />}>
        <TodoList />
      </Suspense>
      
      <Suspense fallback={<SettingsSkeleton />}>
        <Settings />
      </Suspense>
    </div>
  );
}
```

## ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æœ€é©åŒ–

### 1. ãƒ¡ãƒ¢åŒ–ã®é©ç”¨
```typescript
// src/components/UserCard.tsx
import { memo } from 'react';

const UserCard = memo(function UserCard({ user }: { user: User }) {
  return (
    <div>
      <h3>{user.name}</h3>
      <p>{user.email}</p>
    </div>
  );
});
```

### 2. ä»®æƒ³åŒ–ã®å®Ÿè£…
```typescript
// å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®å ´åˆ
import { FixedSizeList as List } from 'react-window';

function VirtualizedUserList({ users }: { users: User[] }) {
  const Row = ({ index, style }: { index: number; style: CSSProperties }) => (
    <div style={style}>
      <UserCard user={users[index]} />
    </div>
  );

  return (
    <List
      height={600}
      itemCount={users.length}
      itemSize={80}
      width="100%"
    >
      {Row}
    </List>
  );
}
```

## ç”»åƒãƒ»ã‚¢ã‚»ãƒƒãƒˆæœ€é©åŒ–

### æ¨å¥¨å®Ÿè£…
```typescript
// src/components/UserAvatar.tsx
import Image from 'next/image';

export default function UserAvatar({ src, name }: { src: string; name: string }) {
  return (
    <Image
      src={src}
      alt={`${name}ã®ã‚¢ãƒã‚¿ãƒ¼`}
      width={64}
      height={64}
      className="rounded-full"
      priority={false} // above-the-fold ã§ãªã„å ´åˆ
      placeholder="blur"
      blurDataURL="data:image/svg+xml;base64,..." // ã¼ã‹ã—ç”»åƒ
    />
  );
}
```

## ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

### 1. Next.js ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ´»ç”¨
```typescript
// src/lib/data-cache.ts
import { unstable_cache } from 'next/cache';

export const getCachedUsers = unstable_cache(
  async () => {
    const { data } = await supabase
      .from('users')
      .select('*')
      .order('created_at', { ascending: false });
    
    return data;
  },
  ['users-list'],
  {
    revalidate: 300, // 5åˆ†é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥
    tags: ['users'],
  }
);

// ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ç„¡åŠ¹åŒ–
export async function invalidateUsersCache() {
  revalidateTag('users');
}
```

### 2. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥
```typescript
// React Query / SWR ã®æ´»ç”¨ä¾‹
import useSWR from 'swr';

function UserList() {
  const { data: users, error, isLoading } = useSWR(
    '/api/users',
    fetcher,
    {
      revalidateOnFocus: false,
      revalidateOnReconnect: false,
      refreshInterval: 300000, // 5åˆ†
    }
  );

  if (isLoading) return <UserListSkeleton />;
  if (error) return <ErrorMessage />;
  
  return <UserTable users={users} />;
}
```

## Core Web Vitals æœ€é©åŒ–

### 1. LCP (Largest Contentful Paint)
```typescript
// é‡è¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å„ªå…ˆèª­ã¿è¾¼ã¿
export default function HomePage() {
  return (
    <div>
      <Image
        src="/hero-image.jpg"
        alt="ãƒ¡ã‚¤ãƒ³ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«"
        width={1200}
        height={600}
        priority // LCPè¦ç´ ã¨ã—ã¦å„ªå…ˆ
      />
    </div>
  );
}
```

### 2. CLS (Cumulative Layout Shift)
```css
/* å›ºå®šã‚µã‚¤ã‚ºã®ç¢ºä¿ */
.image-container {
  width: 300px;
  height: 200px;
  position: relative;
}

.skeleton {
  display: block;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
}
```

### 3. FID (First Input Delay)
```typescript
// ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®æœ€é©åŒ–
import { useCallback } from 'react';

function OptimizedButton() {
  const handleClick = useCallback((event: React.MouseEvent) => {
    event.preventDefault();
    // é‡ã„å‡¦ç†ã‚’ Web Workers ã«å§”è­²
    const worker = new Worker('/workers/data-processor.js');
    worker.postMessage(data);
  }, []);

  return <button onClick={handleClick}>å‡¦ç†å®Ÿè¡Œ</button>;
}
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–

### 1. Web Vitals ã®è¨ˆæ¸¬
```typescript
// src/lib/analytics.ts
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals';

function sendToAnalytics(metric: any) {
  // Google Analytics ã‚„ä»–ã®åˆ†æãƒ„ãƒ¼ãƒ«ã«é€ä¿¡
  console.log(metric);
}

// å„ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®è¨ˆæ¸¬
getCLS(sendToAnalytics);
getFID(sendToAnalytics);
getFCP(sendToAnalytics);
getLCP(sendToAnalytics);
getTTFB(sendToAnalytics);
```

### 2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹äºˆç®—
```javascript
// performance-budget.config.js
module.exports = {
  'first-load-js': 100, // KB
  'page-size': 500, // KB
  'lighthouse-performance': 90, // ã‚¹ã‚³ã‚¢
  'lighthouse-accessibility': 95,
  'lighthouse-best-practices': 90,
  'lighthouse-seo': 95,
};
```

## æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ 

### å„ªå…ˆåº¦: é«˜ï¼ˆ1-2é€±é–“ï¼‰
1. ä¸å¿…è¦ãª Client Component ã® Server Component åŒ–
2. Supabase ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³åŒ–
3. ä¸¦åˆ—ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã®å®Ÿè£…

### å„ªå…ˆåº¦: ä¸­ï¼ˆ1ãƒ¶æœˆï¼‰
1. å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰åˆ†å‰²
2. React Suspense ã®å°å…¥
3. ç”»åƒæœ€é©åŒ–ã®å®Ÿè£…

### å„ªå…ˆåº¦: ä½ï¼ˆ2-3ãƒ¶æœˆï¼‰
1. ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã®æœ€é©åŒ–
2. ä»®æƒ³åŒ–ã®å®Ÿè£…ï¼ˆå¤§é‡ãƒ‡ãƒ¼ã‚¿ã®å ´åˆï¼‰
3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ã®å°å…¥

## ã¾ã¨ã‚

ç¾åœ¨ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯åŸºæœ¬çš„ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¯è‰¯å¥½ã§ã™ãŒã€Next.js 15 ã¨ React Server Components ã®æ½œåœ¨èƒ½åŠ›ã‚’ååˆ†ã«æ´»ç”¨ã§ãã¦ã„ã¾ã›ã‚“ã€‚ç‰¹ã« Server/Client ã®é©åˆ‡ãªåˆ†é›¢ã¨ä¸¦åˆ—ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã®å®Ÿè£…ã«ã‚ˆã‚Šã€å¤§å¹…ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸ŠãŒæœŸå¾…ã§ãã¾ã™ã€‚