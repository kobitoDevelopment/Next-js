# å…¨ä½“è¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼

## ç·è©•

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹é€ ã‚„TypeScriptã®ä½¿ç”¨æ–¹æ³•ã¯è‰¯å¥½ã§ã™ãŒã€èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®äºŒé‡å®Ÿè£…ãŒè¨­è¨ˆã®ä¸€è²«æ€§ã‚’è‘—ã—ãæã­ã¦ã„ã¾ã™ã€‚ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®çµ±ä¸€ãŒæ€¥å‹™ã§ã™ã€‚

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### ğŸ‘ è‰¯ã„ç‚¹

#### 1. é©åˆ‡ãªè²¬å‹™åˆ†é›¢
```typescript
// è‰¯ã„ä¾‹: ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åˆ†é›¢
// src/app/mypage2/page.tsx
export default function MyPage2Page() {
  return <MyPage />;
}

// src/app/components/mypage2/MyPage.tsx
export default async function MyPage() {
  // å®Ÿéš›ã®ãƒ­ã‚¸ãƒƒã‚¯
}
```

#### 2. ä¸€è²«ã—ãŸå‘½åè¦å‰‡
- ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: kebab-caseï¼ˆ`signin2`, `mypage2`ï¼‰
- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: PascalCase
- é–¢æ•°ãƒ»å¤‰æ•°: camelCase

#### 3. å‹å®‰å…¨æ€§ã®ç¢ºä¿
```typescript
// src/app/types/signin/auth.d.ts
export type User = {
  id: string;
  email: string;
  username: string;
  role: 'admin' | 'user';
  is_active: boolean;
  created_at: string;
  updated_at: string;
};
```

### âš ï¸ å•é¡Œç‚¹

#### 1. é‡å¤§: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®äºŒé‡å®Ÿè£…
**å•é¡Œ**: åŒã˜æ©Ÿèƒ½ã«å¯¾ã—ã¦è¤‡æ•°ã®å®Ÿè£…ãŒæ··åœ¨
- `signin` vs `signin2`
- `signup` vs `signup2`
- Context API vs Server Actions

**å½±éŸ¿**: 
- ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ã®ä½ä¸‹
- ãƒã‚°ã®æ¸©åºŠ
- ãƒãƒ¼ãƒ é–‹ç™ºæ™‚ã®æ··ä¹±

**æ¨å¥¨**: Server Actions ãƒ™ãƒ¼ã‚¹ã«çµ±ä¸€

#### 2. èªè¨¼çŠ¶æ…‹ç®¡ç†ã®è¤‡é›‘æ€§
```typescript
// å•é¡Œã®ã‚ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰èªè¨¼
// src/app/context/AuthContext.tsx
export const setCookie = (name: string, value: string, days = 7) => {
  const expires = new Date(Date.now() + days * 864e5).toUTCString();
  document.cookie = `${name}=${encodeURIComponent(value)}; expires=${expires}; path=/`;
};
```

**æ¨å¥¨**: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã«ä¸€æœ¬åŒ–

## çŠ¶æ…‹ç®¡ç†ãƒ‘ã‚¿ãƒ¼ãƒ³

### ç¾çŠ¶ã®å•é¡Œ

#### 1. èªè¨¼çŠ¶æ…‹ã®é‡è¤‡ç®¡ç†
- AuthContextï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰
- cookiesï¼ˆã‚µãƒ¼ãƒãƒ¼ï¼‰
- middlewareï¼ˆã‚µãƒ¼ãƒãƒ¼ï¼‰

#### 2. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã®è¤‡é›‘åŒ–
```mermaid
graph TD
    A[User Login] --> B[AuthContext]
    A --> C[Server Actions]
    B --> D[Client Cookies]
    C --> E[Server Cookies]
    D --> F[UI Update]
    E --> F
```

### æ”¹å–„æ¡ˆ: çµ±ä¸€ã•ã‚ŒãŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```typescript
// ææ¡ˆ: Data Access Layer ãƒ‘ã‚¿ãƒ¼ãƒ³
// src/lib/dal/auth.ts
export class AuthDataAccess {
  async getCurrentUser(): Promise<User | null> {
    const session = await this.validateSession();
    if (!session) return null;
    
    return this.getUserById(session.userId);
  }
  
  private async validateSession() {
    const cookieStore = cookies();
    const token = cookieStore.get('session')?.value;
    
    if (!token) return null;
    
    try {
      return jwt.verify(token, process.env.JWT_SECRET!);
    } catch {
      return null;
    }
  }
}
```

## TypeScript è¨­è¨ˆå“è³ª

### ğŸ‘ è‰¯ã„ç‚¹

#### 1. å³å¯†ãªå‹å®šç¾©
```typescript
// src/app/utils/validation.ts
export const signInSchema = z.object({
  email: z.string().email('æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'),
  password: z.string().min(6, 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯6æ–‡å­—ä»¥ä¸Šã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™'),
});
```

#### 2. é©åˆ‡ãªå‹ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
```typescript
export type SignInFormState = {
  errors?: string[];
};
```

### âš ï¸ æ”¹å–„ç‚¹

#### 1. å‹å®šç¾©ã®é‡è¤‡
**å•é¡Œ**: è¤‡æ•°ç®‡æ‰€ã§åŒã˜Userã‚¿ã‚¤ãƒ—ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹

**æ¨å¥¨**: å…±é€šå‹å®šç¾©ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä½œæˆ
```typescript
// src/shared/types/index.ts
export type User = {
  id: string;
  email: string;
  role: 'admin' | 'user';
  created_at: string;
  updated_at: string;
};

// å„æ©Ÿèƒ½ã§ã®å†åˆ©ç”¨
export type AuthUser = Pick<User, 'id' | 'email' | 'role'>;
export type UserProfile = Omit<User, 'id'>;
```

#### 2. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®çµ±ä¸€
**å•é¡Œ**: Zodã‚¹ã‚­ãƒ¼ãƒã¨æ‰‹å‹•ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ··åœ¨

**æ¨å¥¨**: Zodã‚¹ã‚­ãƒ¼ãƒã«çµ±ä¸€
```typescript
// src/shared/schemas/user.ts
export const userSchema = z.object({
  id: z.string().uuid(),
  email: z.string().email(),
  role: z.enum(['admin', 'user']),
});

export type UserType = z.infer<typeof userSchema>;
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­è¨ˆ

### ç¾çŠ¶åˆ†æ

#### ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚º (è‰¯å¥½)
```
First Load JS: 101 kB
â”œ chunks/pages/_app.js: 81.5 kB
â”œ chunks/webpack.js: 993 B
â”” css/globals.css: 195 B
```

#### Server/Client ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½¿ç”¨çŠ¶æ³
```typescript
// è‰¯ã„ä¾‹: Server Component
// src/app/components/mypage2/MyPage.tsx
export default async function MyPage() {
  const cookieStore = await cookies();
  // ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ãƒ‡ãƒ¼ã‚¿å–å¾—
}

// æ”¹å–„ãŒå¿…è¦: ä¸å¿…è¦ãª Client Component
// ä¸€éƒ¨ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ 'use client' ãŒéåº¦ã«ä½¿ç”¨
```

### æ”¹å–„ææ¡ˆ

#### 1. å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®æ´»ç”¨
```typescript
// é‡ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é…å»¶èª­ã¿è¾¼ã¿
const AdminPanel = dynamic(() => import('@/features/admin/ui/Panel'), {
  loading: () => <AdminSkeleton />,
  ssr: false, // å¿…è¦ã«å¿œã˜ã¦
});
```

#### 2. ãƒ‡ãƒ¼ã‚¿å–å¾—ã®æœ€é©åŒ–
```typescript
// ç¾çŠ¶: å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§å€‹åˆ¥å–å¾—
// æ¨å¥¨: çµ±åˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿å–å¾—æˆ¦ç•¥

export async function getServerSideProps() {
  const [user, todos] = await Promise.all([
    getUserData(),
    getTodosData(),
  ]);
  
  return { props: { user, todos } };
}
```

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¨­è¨ˆ

### ğŸ‘ è‰¯ã„å®Ÿè£…
```typescript
// src/app/components/signin2/actions.ts
const errors: string[] = [];
if (typeof email !== 'string' || typeof password !== 'string') {
  errors.push('ãƒ•ã‚©ãƒ¼ãƒ ã®å…¥åŠ›ãŒä¸æ­£ã§ã™');
  return { errors };
}
```

### æ”¹å–„ææ¡ˆ

#### 1. ã‚¨ãƒ©ãƒ¼ãƒã‚¦ãƒ³ãƒ€ãƒªã®å°å…¥
```typescript
// src/app/components/ErrorBoundary.tsx
export function ErrorBoundary({ children }: { children: React.ReactNode }) {
  return (
    <ErrorBoundary fallback={<ErrorFallback />}>
      {children}
    </ErrorBoundary>
  );
}
```

#### 2. çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
```typescript
// src/lib/errors.ts
export class AppError extends Error {
  constructor(
    message: string,
    public code: string,
    public statusCode: number = 500
  ) {
    super(message);
  }
}

export function handleError(error: unknown): AppError {
  if (error instanceof AppError) return error;
  
  console.error('Unexpected error:', error);
  return new AppError('ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'INTERNAL_ERROR');
}
```

## æ¨å¥¨ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è¨ˆç”»

### ãƒ•ã‚§ãƒ¼ã‚º1: çµ±åˆï¼ˆ2é€±é–“ï¼‰
1. èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®çµ±ä¸€ï¼ˆServer Actions ã®ã¿ï¼‰
2. é‡è¤‡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å‰Šé™¤
3. å‹å®šç¾©ã®çµ±ä¸€

### ãƒ•ã‚§ãƒ¼ã‚º2: æœ€é©åŒ–ï¼ˆ4é€±é–“ï¼‰
1. Data Access Layer ã®å®Ÿè£…
2. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®çµ±ä¸€
3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### ãƒ•ã‚§ãƒ¼ã‚º3: å¼·åŒ–ï¼ˆ6é€±é–“ï¼‰
1. è©³ç´°ãªãƒ­ã‚°æ©Ÿèƒ½
2. ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
3. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™

## ã¾ã¨ã‚

åŸºç›¤ã¨ãªã‚‹è¨­è¨ˆã¯è‰¯å¥½ã§ã™ãŒã€èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®äºŒé‡å®Ÿè£…ãŒå…¨ä½“ã®å“è³ªã‚’è‘—ã—ãä½ä¸‹ã•ã›ã¦ã„ã¾ã™ã€‚Server Actions ãƒ™ãƒ¼ã‚¹ã®ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«çµ±ä¸€ã™ã‚‹ã“ã¨ã§ã€ä¿å®ˆæ€§ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ä¸¡æ–¹ã‚’å¤§å¹…ã«æ”¹å–„ã§ãã¾ã™ã€‚